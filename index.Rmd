---
title: "Philadelphia & Lancaster COVID Hospitilizations"
subtitle: "Hospitilizations by Type and Availabe ICU Beds for Lancaster and Philadelphia Counties"
output:
  rmarkdown::html_document:
    theme: flatly
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, warning = FALSE, message = FALSE)

library(tidyverse)
library(jsonlite)
library(tidyr)
library(zoo)
library(plotly)
library(kableExtra)
library(data.table)
library(lubridate)
library(plotly)

options(scipen = 999) 
```

This website is a test site, intended for personal use only. Please do not use this site as a source for reliable information on COVID.

```{r read in philadelphia}

url <- URLencode("https://data.pa.gov/resource/kayn-sjhx.json?county=Philadelphia")

data_import <- fromJSON(url)

data_import$date <- as_datetime(data_import$date)

colnames <- colnames(data_import[3:37])

data_longer <- pivot_longer(data_import, cols = colnames, 
                            names_to = "indicator", values_to = "number") %>%
  mutate(number = as.numeric(number))

```


```{r plot philadelphia}

philadelphia <- data_longer %>% 
  filter(county == "Philadelphia", 
         indicator %in% c("date", "covid_patients", "covid_vents", 
                          "covid_patients_adult_in_icu", "icu_avail")) %>% 
  drop_na()

ggplotly(ggplot(philadelphia, aes(x = date, y = number)) + 
  geom_line(aes(color = indicator), size = 1) +
  ggtitle("Philadelphia COVID Hospitilizations") +
  theme_minimal())
```

```{r read in lancaster}

url <- URLencode("https://data.pa.gov/resource/kayn-sjhx.json?county=Lancaster")

data_import <- fromJSON(url)

data_import$date <- as_datetime(data_import$date)

colnames <- colnames(data_import[3:36])

data_longer <- pivot_longer(data_import, cols = colnames, 
                            names_to = "indicator", values_to = "number") %>%
  mutate(number = as.numeric(number))

```


```{r plot lancaster}

lancaster <- data_longer %>% 
  filter(county == "Lancaster", 
         indicator %in% c("date", "covid_patients", "covid_vents", 
                          "covid_patients_adult_in_icu", "icu_avail")) %>% 
  drop_na()

ggplotly(ggplot(lancaster, aes(x = date, y = number)) + 
  geom_line(aes(color = indicator), size = 1) +
  ggtitle("Lancaster COVID Hospitilizations") +
  theme_minimal())
```